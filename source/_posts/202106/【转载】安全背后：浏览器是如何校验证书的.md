title: ã€è½¬è½½ã€‘å®‰å…¨èƒŒåï¼šæµè§ˆå™¨æ˜¯å¦‚ä½•æ ¡éªŒè¯ä¹¦çš„
date: 2021-06-18 23:43:51
comment: false
toc: true
category: 
 - å®‰å…¨
tags: 
 - è½¬è½½
 - è¯ä¹¦
 - https
 - æµè§ˆå™¨
 - æ ¡éªŒ
---

æœ¬æ–‡è½¬è½½è‡ªï¼š[å®‰å…¨èƒŒåï¼šæµè§ˆå™¨æ˜¯å¦‚ä½•æ ¡éªŒè¯ä¹¦çš„ - CJ Ting&#39;s Blog](https://cjting.me/2021/03/02/how-to-validate-tls-certificate/)

---

ç°å¦‚ä»Šçš„ Webï¼ŒHTTPS æ—©å·²ç»æˆä¸ºæ ‡é…ï¼Œå…¬å¼€çš„ HTTP ç½‘ç«™å·²ç»å’Œ Flash ä¸€æ ·ï¼Œæ…¢æ…¢åœ¨æ¶ˆäº¡äº†ã€‚

å¯ç”¨ HTTPS çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªå«åš **è¯ä¹¦** çš„ä¸œè¥¿ã€‚ä¸çŸ¥é“å¤§å®¶æ˜¯å¦æœ‰ç•™æ„ï¼Œå‰å‡ å¹´ä¸Š 12306 çš„æ—¶å€™ï¼Œæµè§ˆå™¨éƒ½ä¼šæç¤ºã€Œæ‚¨çš„é“¾æ¥ä¸æ˜¯ç§å¯†é“¾æ¥ã€ï¼Œè¿™å…¶å®å°±æ˜¯å› ä¸º 12306 çš„è¯ä¹¦æœ‰é—®é¢˜ã€‚å¦‚æœç‚¹å‡»ã€Œç»§ç»­å‰å¾€ã€ï¼Œæ‰“å¼€ 12306 ç½‘ç«™ï¼Œå®ƒä¼šæç¤ºä½ ä¸‹è½½å®‰è£…å®ƒæä¾›çš„ â€œæ ¹è¯ä¹¦â€ã€‚

![](https://b3logfile.com/file/2021/06/solo-fetchupload-6495259772113828949-601e71b2.png)

é‚£ä¹ˆï¼Œè¯ä¹¦æ˜¯ä»€ä¹ˆï¼Ÿé‡Œé¢å«æœ‰ä»€ä¹ˆå†…å®¹ï¼Ÿæµè§ˆå™¨ä¸ºä»€ä¹ˆä¼šä¸ä¿¡ä»» 12306 çš„è¯ä¹¦ï¼Ÿä¸ºä»€ä¹ˆä¸‹è½½ 12306 æä¾›çš„æ ¹è¯ä¹¦å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿæ ¹è¯ä¹¦åˆæ˜¯ä»€ä¹ˆï¼Ÿ

## è¯ä¹¦ï¼Œå…¬é’¥å’Œç§é’¥

æˆ‘ä»¬å…ˆæ¥ç®€å•å›é¡¾ä¸€ä¸‹ TLS å’Œ HTTPSã€‚å…³äºè¿™ä¸ªè¯é¢˜ï¼Œæˆ‘åœ¨ [ä»é›¶å¼€å§‹æ­å»ºä¸€ä¸ª HTTPS ç½‘ç«™](https://cjting.me/2016/09/05/build-a-https-site-from-scratch/) è¿™ç¯‡åšå®¢ä¸­æœ‰è¯¦ç»†çš„è®ºè¿°ï¼Œå¯¹ç»†èŠ‚æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å…ˆå»è¯»ä¸€ä¸‹è¿™ç¯‡åšå®¢ã€‚

HTTPS å…¨ç§°æ˜¯ HTTP Over TLSï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ TLS è¿›è¡Œ HTTP é€šä¿¡ã€‚

TLS (Transport Layer Security) æ˜¯ä¸€ä¸ªå®‰å…¨é€šä¿¡åè®®ï¼Œç”¨äºå»ºç«‹ä¸€ä¸ªå®‰å…¨é€šé“æ¥äº¤æ¢æ•°æ®ã€‚

çœ‹åå­—å¯ä»¥çŸ¥é“è¿™æ˜¯ä¸€ä¸ªä¼ è¾“å±‚åè®®ï¼Œå› æ­¤åº”ç”¨å±‚åè®®å¯¹å®ƒæ˜¯æ²¡æœ‰æ„ŸçŸ¥çš„ï¼ŒHTTP, FTP, SMTP éƒ½å¯ä»¥å’Œ TLS é…åˆä½¿ç”¨ã€‚

Tip: å…³äºç½‘ç»œåè®®ï¼Œé˜®ä¸€å³°çš„è¿™ç¯‡åšå®¢ [äº’è”ç½‘åè®®å…¥é—¨ï¼ˆä¸€ï¼‰](https://www.ruanyifeng.com/blog/2012/05/internet_protocol_suite_part_i.html) å†™çš„å¾ˆå¥½ï¼Œå€¼å¾—ä¸€çœ‹ã€‚

TLS åˆ›å»ºå®‰å…¨é“¾æ¥çš„æ­¥éª¤å¦‚ä¸‹ï¼š

* åŒæ–¹åå•†ä½¿ç”¨çš„åè®®ç‰ˆæœ¬ï¼ŒåŠ å¯†ç®—æ³•ç­‰ç»†èŠ‚
* æœåŠ¡å™¨å‘é€ è¯ä¹¦ ç»™å®¢æˆ·ç«¯
* å®¢æˆ·ç«¯æ ¡éªŒè¯ä¹¦æœ‰æ•ˆæ€§
* åŒæ–¹æ ¹æ®æ¡æ‰‹çš„ä¸€äº›å‚æ•°ç”Ÿæˆä¸€ä¸ªå¯¹ç§°ç§˜é’¥ï¼Œæ­¤åæ‰€æœ‰çš„å†…å®¹ä½¿ç”¨è¿™ä¸ªç§˜é’¥æ¥åŠ å¯†

æˆ‘ä»¬å…ˆæ¥çœ‹è¯ä¹¦ï¼Œè¯ä¹¦æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œé‡Œé¢å«æœ‰ç›®æ ‡ç½‘ç«™çš„å„ç§ä¿¡æ¯ã€‚

ä¾‹å¦‚ç½‘ç«™çš„åŸŸåï¼Œè¯ä¹¦çš„æœ‰æ•ˆæ—¶é—´ï¼Œç­¾å‘æœºæ„ç­‰ï¼Œå…¶ä¸­æœ€é‡è¦çš„æ˜¯è¿™ä¸¤ä¸ªï¼š

* ç”¨äºç”Ÿæˆå¯¹ç§°ç§˜é’¥çš„å…¬é’¥
* ç”±ä¸Šçº§è¯ä¹¦ç­¾å‘çš„ç­¾å

è¯ä¹¦æ–‡ä»¶çš„æ ¼å¼å«åš X.509ï¼Œç”± [RFC5280](https://tools.ietf.org/html/rfc5280) è§„èŒƒè¯¦ç»†å®šä¹‰ã€‚å­˜å‚¨ä¸Šåˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§å«åš DERï¼Œæ˜¯äºŒè¿›åˆ¶çš„ï¼Œè¿˜æœ‰ä¸€ç§å«åš PEMï¼Œæ˜¯åŸºäº Base64 çš„ã€‚

å…³äº RSA çš„å…¬é’¥å’Œç§é’¥è®°ä½ä¸€ç‚¹å°±è¡Œï¼š**æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç®—æ³•ç”Ÿæˆä¸€å¯¹é’¥åŒ™ï¼Œä»–ä»¬æ»¡è¶³ä¸€ä¸ªæ€§è´¨ï¼šå…¬é’¥åŠ å¯†çš„ç§é’¥å¯ä»¥è§£å¼€ï¼Œç§é’¥åŠ å¯†çš„å…¬é’¥å¯ä»¥è§£å¼€** ã€‚

Tip: RSA ç®—æ³•çš„å…·ä½“å·¥ä½œåŸç†å¯ä»¥å‚è€ƒæˆ‘è¿™ç¯‡åšå®¢ [RSA çš„åŸç†ä¸å®ç°](https://cjting.me/2020/03/13/rsa/)ã€‚

è¯ä¹¦ï¼Œé¡¾åæ€ä¹‰ï¼Œæ˜¯ç”¨æ¥è¯æ˜è‡ªå·±èº«ä»½çš„ã€‚å› ä¸ºå‘é€è¯ä¹¦çš„æ—¶å€™æ˜¯æ˜æ–‡çš„ï¼ˆè¿™ä¸€æ­¥ä¹Ÿæ²¡æ³•åŠ å¯†ï¼‰ï¼Œæ‰€ä»¥è¯ä¹¦å†…å®¹æ˜¯å¯ä»¥è¢«ä¸­é—´è®¾å¤‡ç¯¡æ”¹çš„ã€‚

é‚£ä¹ˆè¦æ€æ ·è®¾è®¡ä¸€å¥—æœºåˆ¶ä¿è¯å½“æˆ‘è®¿é—® github.com çš„æ—¶å€™ï¼Œæ”¶åˆ°çš„è¯ä¹¦ç¡®å®æ˜¯ github.com çš„è¯ä¹¦ï¼Œè€Œä¸æ˜¯æŸä¸ªä¸­é—´è®¾å¤‡éšæ„å‘æ¥çš„è¯ä¹¦ï¼Ÿ

å¤§å®¶å¯ä»¥æ€è€ƒä¸€ä¸‹è¿™ä¸ªé—®é¢˜ ğŸ¤”ã€‚

è§£å†³åŠæ³•æ˜¯é‡‡ç”¨ã€Œä¿¡ä»»é“¾ã€ã€‚

é¦–å…ˆï¼Œæœ‰ä¸€æ‰¹è¯ä¹¦é¢å‘æœºæ„ï¼ˆCertificate Authorityï¼Œç®€ç§°ä¸º CAï¼‰ï¼Œç”±ä»–ä»¬ç”Ÿæˆç§˜é’¥å¯¹ï¼Œå…¶ä¸­ç§é’¥ä¿å­˜å¥½ï¼Œå…¬é’¥ä»¥è¯ä¹¦çš„æ ¼å¼å®‰è£…åœ¨æˆ‘ä»¬çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œè¿™å°±æ˜¯ **æ ¹è¯ä¹¦** ã€‚

æˆ‘ä»¬çš„æ‰‹æœºã€ç”µè„‘ã€ç”µè§†æœºçš„æ“ä½œç³»ç»Ÿä¸­éƒ½é¢„è£…äº† CA çš„æ ¹è¯ä¹¦ï¼Œä»–ä»¬æ˜¯æ‰€æœ‰ä¿¡ä»»æ„å»ºçš„åŸºçŸ³ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±ä¸‹è½½ä»»æ„çš„æ ¹è¯ä¹¦è¿›è¡Œå®‰è£…ã€‚

æ¥ä¸‹æ¥ï¼Œåªè¦è®¾è®¡ä¸€ä¸ªä½“ç³»ï¼Œèƒ½å¤Ÿè¯æ˜ A è¯ä¹¦ç­¾å‘äº† B è¯ä¹¦å³å¯ã€‚è¿™æ ·å¯¹äºæ”¶åˆ°çš„ä»»ä½•ä¸€ä¸ªè¯ä¹¦ï¼Œé¡ºè—¤æ‘¸ç“œï¼Œåªè¦æœ€ä¸Šé¢çš„æ ¹è¯ä¹¦åœ¨ç³»ç»Ÿä¸­å­˜åœ¨ï¼Œå³å¯è¯æ˜è¯¥è¯ä¹¦æœ‰æ•ˆã€‚

æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬æ”¶åˆ°äº†æœåŠ¡å™¨å‘è¿‡æ¥çš„ C è¯ä¹¦ï¼Œæˆ‘ä»¬éªŒè¯äº† C æ˜¯ç”± B ç­¾å‘çš„ï¼Œç„¶ååˆéªŒè¯äº† B æ˜¯ç”± A ç­¾å‘çš„ï¼Œè€Œ A åœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­å­˜åœ¨ï¼Œé‚£ä¹Ÿå°±è¯æ˜äº† C è¿™ä¸ªè¯ä¹¦çš„æœ‰æ•ˆæ€§ã€‚

è¿™å…¶ä¸­ï¼ŒA æ˜¯æ ¹è¯ä¹¦ï¼ŒB æ˜¯ä¸­é—´è¯ä¹¦ï¼ŒC æ˜¯å¶è¯ä¹¦ï¼ˆç±»ä¼¼æ ‘ä¸­çš„å¶èŠ‚ç‚¹ï¼‰ã€‚ä¸­é—´è¯ä¹¦å¯ä»¥æœ‰å¾ˆå¤šä¸ªï¼Œä¿¡ä»»çš„é“¾æ¡å¯ä»¥ä»»æ„é•¿ï¼Œåªè¦æœ€ç»ˆèƒ½åˆ°æ ¹è¯ä¹¦å³å¯ã€‚

å¾—ç›Šäº RSA çš„éå¯¹ç§°æ€§è´¨ï¼ŒéªŒè¯ A æ˜¯å¦ç­¾å‘äº† B è¯ä¹¦å¾ˆç®€å•ï¼š

* è®¡ç®— B çš„ hash å€¼ï¼ˆç®—æ³•éšä¾¿ï¼Œæ¯”å¦‚ SHA1ï¼‰
* ä½¿ç”¨ A çš„ **ç§é’¥** å¯¹è¯¥ hash è¿›è¡ŒåŠ å¯†ï¼ŒåŠ å¯†ä»¥åçš„å†…å®¹å«åšã€Œç­¾åï¼ˆSignatureï¼‰ã€
* å°†è¯¥ã€Œç­¾åã€é™„åœ¨ B è¯ä¹¦ä¸­

A ä½¿ç”¨è‡ªå·±çš„ç§é’¥ç»™ B ç”Ÿæˆç­¾åçš„è¿‡ç¨‹ä¹Ÿå°±æ˜¯ã€Œç­¾å‘è¯ä¹¦ã€ï¼Œå…¶ä¸­ A å«åš Issuerï¼ŒB å«åš Subjectã€‚

è¿™æ ·ï¼Œå½“æˆ‘ä»¬æ”¶åˆ° B è¯ä¹¦æ—¶ï¼Œé¦–å…ˆä½¿ç”¨ A è¯ä¹¦çš„å…¬é’¥ï¼ˆå…¬é’¥å­˜å‚¨åœ¨è¯ä¹¦ä¸­ï¼‰è§£å¼€ç­¾åè·å¾— hashï¼Œç„¶åè®¡ç®— B çš„ hashï¼Œå¦‚æœä¸¤ä¸ª hash åŒ¹é…ï¼Œè¯´æ˜ B ç¡®å®æ˜¯ç”± A ç­¾å‘çš„ã€‚

é‡å¤ä¸Šé¢çš„è¿‡ç¨‹ï¼Œç›´åˆ°æ ¹è¯ä¹¦ï¼Œå°±å¯ä»¥éªŒè¯æŸä¸ªè¯ä¹¦çš„æœ‰æ•ˆæ€§ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬æ¥é—®å‡ ä¸ªé—®é¢˜ã€‚

### ä¸ºä»€ä¹ˆéœ€è¦ä¸­é—´è¯ä¹¦ï¼Ÿ

ä¸ºä»€ä¹ˆè¦è®¾è®¡ä¸­é—´è¯ä¹¦è¿™ä¸ªç¯èŠ‚ï¼Ÿç›´æ¥ä½¿ç”¨æ ¹è¯ä¹¦è¿›è¡Œç­¾å‘ä¸å¥½å—ï¼Ÿ

è¿™æ˜¯å› ä¸ºæ ¹è¯ä¹¦çš„ç§é’¥å®‰å…¨æ€§è‡³å…³é‡è¦ï¼Œä¸€æ—¦è¢«æ³„éœ²ï¼Œå°†å¼•èµ·å·¨å¤§çš„å®‰å…¨é—®é¢˜ã€‚

æ‰€ä»¥ï¼Œæ ¹è¯ä¹¦çš„ç§é’¥éƒ½æ˜¯è¢«ä¿å­˜åœ¨ç¦»çº¿çš„è®¡ç®—æœºä¸­ï¼Œæœ‰ä¸¥æ ¼çš„æ“ä½œè§„ç« ï¼Œæ¯æ¬¡éœ€è¦ä½¿ç”¨æ—¶ï¼Œä¼šæœ‰ä¸“äººå°†æ•°æ®é€šè¿‡ USB æ‹·è´è¿‡å»ï¼Œæ“ä½œå®Œäº†ä»¥åï¼Œå†å°†æ•°æ®å¸¦å‡ºæ¥ã€‚

åœ¨è¿™å¥—æµç¨‹ä¸‹ï¼Œç›´æ¥å°†æ ¹è¯ä¹¦ç”¨äºç­¾å‘æ™®é€šè¯ä¹¦æ˜¯ä¸ç°å®çš„ã€‚æƒ³æƒ³è¿™ä¸ªä¸–ç•Œä¸Šæœ‰å¤šå°‘ç½‘ç«™ï¼Œæ¯å¤©å¯¹è¯ä¹¦çš„éœ€æ±‚é‡éƒ½æ˜¯å·¨å¤§çš„ï¼Œæ ¹è¯ä¹¦çš„æ“ä½œæ•ˆç‡æ— æ³•æ»¡è¶³è¦æ±‚ï¼Œå› ä¸ºä¸èƒ½æ‰¹é‡å’Œè‡ªåŠ¨åŒ–ã€‚

åŒæ—¶ï¼Œå¯¹æ ¹è¯ä¹¦ç§é’¥çš„æ“ä½œè¶Šå¤šï¼Œæ³„éœ²çš„é£é™©ä¹Ÿå°±è¶Šå¤§ï¼Œå› æ­¤ï¼Œäººä»¬å°±å‘æ˜äº†ä¸­é—´è¯ä¹¦ã€‚

ä½¿ç”¨æ ¹è¯ä¹¦ç­¾å‘ä¸€äº›ä¸­é—´è¯ä¹¦ï¼Œè¿™äº›ä¸­é—´è¯ä¹¦å°±å¯ä»¥ç”¨æ¥ç­¾å‘å¤§é‡çš„å¶è¯ä¹¦ï¼Œè¿™ä¸ªè¿‡ç¨‹å®Œå…¨å¯ä»¥æ˜¯è‡ªåŠ¨åŒ–çš„ï¼Œå°±åƒ Letâ€™s Encrypt é‚£æ ·ã€‚

åŒæ—¶ï¼Œå³ä¾¿ä¸­é—´è¯ä¹¦çš„ç§é’¥æ³„éœ²äº†ä¹Ÿä¸è¦ç´§ï¼Œå¯ä»¥ä½¿ç”¨æ ¹è¯ä¹¦æŠŠå®ƒä»¬æ’¤é”€æ‰ï¼Œå…·ä½“æ€ä¹ˆæ’¤é”€æ˜¯å¦å¤–ä¸€ä¸ªè¯é¢˜äº†ï¼Œè¿™é‡Œä¸å†å±•å¼€ã€‚

é€šè¿‡ä½¿ç”¨ä¸­é—´è¯ä¹¦ï¼Œæˆ‘ä»¬å°±å¯ä»¥åšåˆ°æ—¢æ–¹ä¾¿ï¼Œåˆå®‰å…¨ã€‚

### æµè§ˆå™¨å¦‚ä½•è·å–ä¸­é—´è¯ä¹¦ï¼Ÿ

ä¸€èˆ¬æ¥è¯´ï¼ŒæœåŠ¡å™¨ä¼šå°†ä¸­é—´è¯ä¹¦ä¸€å¹¶å‘é€è¿‡æ¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æˆ‘ä»¬è®¿é—®æŸä¸ªç½‘ç«™æ—¶ï¼Œæ”¶åˆ°çš„ä¸æ˜¯ä¸€ä¸ªè¯ä¹¦ï¼Œè€Œæ˜¯ä¸€ç³»åˆ—è¯ä¹¦ã€‚

å½“ç„¶ï¼Œè¿™ä¸æ˜¯å¼ºåˆ¶è¦æ±‚ï¼Œåœ¨æœåŠ¡å™¨ä¸å‘é€çš„æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨ä¹Ÿä¼šä½¿ç”¨ä¸€äº›æ–¹æ³•å»å®šä½ä¸­é—´è¯ä¹¦ï¼Œæ¯”å¦‚

* ç¼“å­˜ä¹‹å‰ä¸‹è½½è¿‡çš„è¯ä¹¦
* è¯ä¹¦æ–‡ä»¶ä¸­çš„ Authority Information Access (AIA) Extension é‡Œé¢å«æœ‰ä¸Šçº§è¯ä¹¦çš„ç›¸å…³ä¿¡æ¯ï¼Œæµè§ˆå™¨å¯ä»¥ä½¿ç”¨è¿™ä¸ªä¿¡æ¯å»ä¸‹è½½ä¸Šçº§è¯ä¹¦

### æ ¹è¯ä¹¦æœ‰æ—¶æ•ˆå—ï¼Ÿè¿‡æœŸäº†æ€ä¹ˆåŠï¼Ÿ

æ¯ä¸ªè¯ä¹¦éƒ½æœ‰æœ‰æ•ˆæ—¶é—´ï¼Œæ ¹è¯ä¹¦è‡ªç„¶ä¹Ÿä¸ä¾‹å¤–ã€‚

åœ¨ Mac ä¸Šï¼Œæ‰“å¼€ Keychain Accessï¼Œé€‰æ‹©ä¾§è¾¹çš„ `System Roots` å°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç³»ç»Ÿä¸­å®‰è£…çš„æ‰€æœ‰æ ¹è¯ä¹¦ã€‚

![](https://b3logfile.com/file/2021/06/solo-fetchupload-2355572779260704824-d671f483.png)

å…¶ä¸­å¾ˆæ˜æ˜¾åœ°æ˜¾ç¤ºäº†ä¸€æ å«åšã€ŒExpiresã€ï¼Œè¿‡æœŸæ—¶é—´ã€‚

é‚£ä¹ˆï¼Œæ ¹è¯ä¹¦è¿‡æœŸäº†æ€ä¹ˆåŠï¼Ÿ

ç­”æ¡ˆæ˜¯ä¸æ€ä¹ˆåŠï¼Œåœ¨è¿‡æœŸå‰ CA ä¼šç”Ÿæˆæ–°çš„æ ¹è¯ä¹¦ï¼Œå¹¶å’Œå„å¤§äº§å•†åˆä½œï¼Œåœ¨æ“ä½œç³»ç»Ÿå‡çº§çš„æ—¶å€™å®‰è£…åˆ°æˆ‘ä»¬çš„è®¾å¤‡ä¸Šã€‚

è€çš„æ ¹è¯ä¹¦è¿‡æœŸä»¥ååªæ˜¯æ— æ³•å†ä½œä¸ºä¿¡ä»»é”šç‚¹ä¸ºå…¶ä»–çš„è¯ä¹¦æä¾›ä¿¡ä»»è€Œå·²ã€‚

æ ¹è¯ä¹¦çš„ç”Ÿå‘½å‘¨æœŸä¸€èˆ¬æ˜¯ 20 å¹´ï¼ŒLetâ€™s Encrypt ä¹‹å‰ä½¿ç”¨çš„æ ¹è¯ä¹¦æ˜¯ `DST Root CA X3`ï¼Œ2021 å¹´ä¹æœˆå°±è¦è¿‡æœŸäº†ï¼Œè¿™ä¸ªè¯ä¹¦æ˜¯ 2000 å¹´åˆ›å»ºçš„ã€‚

Letâ€™s Encrypt åœ¨ 2015 å¹´åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„æ ¹è¯ä¹¦ `ISRG Root X1`ï¼Œåœ¨ 2018 å¹´è¢«å®Œå…¨è®¤å¯å¹¶é€æ­¥å®‰è£…åˆ°å„ç§è®¾å¤‡ä¸Šã€‚

å®‰è£…æ–°çš„æ ¹è¯ä¹¦çš„å”¯ä¸€æ–¹å¼æ˜¯é€šè¿‡ç³»ç»Ÿæ›´æ–°ï¼Œä½†æ˜¯è¿™å…¶å®æ˜¯ä¸å¯æ§çš„äº‹æƒ…ï¼Œå› ä¸ºæ€»æœ‰ä¸€äº›è®¾å¤‡ä¸ä¼šæ›´æ–°ã€‚

æˆ‘ä»¬å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä¸€ä¸ªè®¾å¤‡åœæ­¢æ›´æ–°ï¼ŒåŒæ—¶é‡Œé¢å†…ç½®çš„æ‰€æœ‰æ ¹è¯ä¹¦éƒ½è¿‡æœŸäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªè®¾å¤‡å°±æ— æ³•å†è¿›è¡Œ HTTPS é€šä¿¡äº†ã€‚

### æ ¹è¯ä¹¦æœ‰ä»€ä¹ˆç‰¹å¾ï¼Ÿæ ¹è¯ä¹¦çš„ç­¾åæ˜¯ä»€ä¹ˆï¼Ÿ

æ¯ä¸ªè¯ä¹¦ä¸­éƒ½å«æœ‰å½“å‰è¯ä¹¦å¯¹è±¡ Subject çš„ä¿¡æ¯ä»¥åŠè¯¥è¯ä¹¦çš„ç­¾å‘è€… Issuer çš„ä¿¡æ¯ã€‚

æ ¹è¯ä¹¦çš„ç‰¹å¾æ˜¯ Subject å’Œ Issuer çš„ä¿¡æ¯æ˜¯ä¸€è‡´çš„ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ã€Œè‡ªç­¾åã€ï¼ˆSelf-Signedï¼‰ã€‚

![](https://b3logfile.com/file/2021/06/solo-fetchupload-8815168925046673207-ef97281b.png)

å› ä¸ºè¯ä¹¦çš„ç­¾åæ˜¯ç”±ä¸Šçº§è¯ä¹¦çš„ç§é’¥æ¥ç­¾çš„ï¼Œæ ¹è¯ä¹¦æ²¡æœ‰ä¸Šçº§è¯ä¹¦ï¼Œæ‰€æœ‰æ ¹è¯ä¹¦çš„ç­¾åæ˜¯ç”¨è‡ªå·±çš„ç§é’¥ç­¾çš„ã€‚

æˆ‘ä»¬å¯ä»¥æ¥éªŒè¯ä¸€ä¸‹ï¼Œä»¥ GitHub ä½¿ç”¨çš„æ ¹è¯ä¹¦ DigiCert High Assurance EV Root CA ä¸ºä¾‹ã€‚

```
# é¦–å…ˆï¼Œæ‰“å¼€ Keychain Accessï¼Œæ‰¾åˆ°ä¸Šè¿°è¯ä¹¦ï¼Œæ‹–æ‹½å‡ºæ¥
# é‡å‘½åä¸º root.cer

# è½¬æ¢ DER åˆ° PEM æ ¼å¼
$ openssl x509 -inform der -in root.cer -out root.pem

# æŸ¥çœ‹è¯ä¹¦çš„ç­¾åï¼Œå¯ä»¥çœ‹åˆ°ç­¾åæ‰€ä½¿ç”¨çš„çš„ hash ç®—æ³•æ˜¯ sha1
$ openssl x509 -in root.pem -text -noout -certopt ca_default -certopt no_validity -certopt no_serial -certopt no_subject -certopt no_extensions -certopt no_signame
    Signature Algorithm: sha1WithRSAEncryption
         1c:1a:06:97:dc:d7:9c:9f:3c:88:66:06:08:57:21:db:21:47:
         f8:2a:67:aa:bf:18:32:76:40:10:57:c1:8a:f3:7a:d9:11:65:
         8e:35:fa:9e:fc:45:b5:9e:d9:4c:31:4b:b8:91:e8:43:2c:8e:
         b3:78:ce:db:e3:53:79:71:d6:e5:21:94:01:da:55:87:9a:24:
         64:f6:8a:66:cc:de:9c:37:cd:a8:34:b1:69:9b:23:c8:9e:78:
         22:2b:70:43:e3:55:47:31:61:19:ef:58:c5:85:2f:4e:30:f6:
         a0:31:16:23:c8:e7:e2:65:16:33:cb:bf:1a:1b:a0:3d:f8:ca:
         5e:8b:31:8b:60:08:89:2d:0c:06:5c:52:b7:c4:f9:0a:98:d1:
         15:5f:9f:12:be:7c:36:63:38:bd:44:a4:7f:e4:26:2b:0a:c4:
         97:69:0d:e9:8c:e2:c0:10:57:b8:c8:76:12:91:55:f2:48:69:
         d8:bc:2a:02:5b:0f:44:d4:20:31:db:f4:ba:70:26:5d:90:60:
         9e:bc:4b:17:09:2f:b4:cb:1e:43:68:c9:07:27:c1:d2:5c:f7:
         ea:21:b9:68:12:9c:3c:9c:bf:9e:fc:80:5c:9b:63:cd:ec:47:
         aa:25:27:67:a0:37:f3:00:82:7d:54:d7:a9:f8:e9:2e:13:a3:
         77:e8:1f:4a

# æå–ç­¾åå†…å®¹åˆ°æ–‡ä»¶ä¸­
$ openssl x509 -in root.pem -text -noout -certopt ca_default -certopt no_validity -certopt no_serial -certopt no_subject -certopt no_extensions -certopt no_signame | grep -v 'Signature Algorithm' | tr -d '[:space:]:' | xxd -r -p > root-signature.bin

# æå–æ ¹è¯ä¹¦ä¸­å«æœ‰çš„å…¬é’¥
$ openssl x509 -in root.pem -noout -pubkey > root-pub.pem

# ä½¿ç”¨å…¬é’¥è§£å¯†ç­¾å
$ openssl rsautl -verify -inkey root-pub.pem -in root-signature.bin -pubin > root-signature-decrypted.bin

# æŸ¥çœ‹è§£å¯†åçš„å†…å®¹
# å¯ä»¥çœ‹åˆ°ï¼Œç­¾åä¸­å­˜å‚¨çš„ hash å€¼ä¸º E35E...13A8
$ openssl asn1parse -inform DER -in root-signature-decrypted.bin
    0:d=0  hl=2 l=  33 cons: SEQUENCE
    2:d=1  hl=2 l=   9 cons: SEQUENCE
    4:d=2  hl=2 l=   5 prim: OBJECT            :sha1
   11:d=2  hl=2 l=   0 prim: NULL
   13:d=1  hl=2 l=  20 prim: OCTET STRING      [HEX DUMP]:E35EF08D884F0A0ADE2F75E96301CE6230F213A8

# æ¥ä¸‹æ¥æˆ‘ä»¬è®¡ç®—è¯ä¹¦çš„ hash å€¼

# é¦–å…ˆæå–è¯ä¹¦çš„ body
# å› ä¸ºè¯ä¹¦ä¸­å«æœ‰ç­¾åï¼Œç­¾åæ˜¯ä¸åŒ…å«åœ¨ hash å€¼è®¡ç®—ä¸­çš„
# æ‰€ä»¥ä¸èƒ½ç®€å•åœ°å¯¹æ•´ä¸ªè¯ä¹¦æ–‡ä»¶è¿›è¡Œ hash è¿ç®—
$ openssl asn1parse -in root.pem -strparse 4 -out root-body.bin &> /dev/null

# è®¡ç®— sha1 å“ˆå¸Œå€¼
$ openssl dgst -sha1 root-body.bin
SHA1(root-body.bin)= e35ef08d884f0a0ade2f75e96301ce6230f213a8
```

hash å€¼åŒ¹é…ï¼Œè¿™ä¹Ÿå°±è¯´æ˜æ ¹è¯ä¹¦ç¡®å®æ˜¯è‡ªç­¾åçš„ï¼Œç”¨è‡ªå·±çš„ç§é’¥ç»™è‡ªå·±ç­¾åã€‚

## çº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…

ç†è®ºçŸ¥è¯†æˆ‘ä»¬å·²ç»å…¨éƒ¨å…·å¤‡äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥å®Œæ•´èµ°ä¸€éæµç¨‹ï¼Œä»¥ github.com ä¸ºä¾‹ï¼Œæ ¡éªŒä¸€ä¸‹å®ƒçš„è¯ä¹¦æ˜¯å¦æœ‰æ•ˆã€‚

```
# æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ github ä¿å­˜æ‰€æœ‰çš„æ–‡ä»¶
$ mkdir github && cd github

# é¦–å…ˆï¼Œæˆ‘ä»¬ä¸‹è½½ github.com å‘é€çš„è¯ä¹¦
$ openssl s_client -connect github.com:443 -showcerts 2>/dev/null </dev/null | sed -n '/-----BEGIN/,/-----END/p' > github.com.crt

# github.com.crt æ˜¯ PEM æ ¼å¼çš„æ–‡æœ¬æ–‡ä»¶
# æ‰“å¼€å¯ä»¥å‘ç°é‡Œé¢æœ‰ä¸¤æ®µ -----BEGIN CERTIFICATE----
# è¿™è¯´æ˜æœ‰ä¸¤ä¸ªè¯ä¹¦ï¼Œä¹Ÿå°±æ˜¯ github.com æŠŠä¸­é—´è¯ä¹¦ä¹Ÿä¸€å¹¶å‘è¿‡æ¥äº†

# æ¥ä¸‹æ¥æˆ‘ä»¬æŠŠä¸¤ä¸ªè¯ä¹¦æå–å‡ºæ¥
$ awk '/BEGIN/,/END/{ if(/BEGIN/){a++}; out="cert"a".tmpcrt"; print >out}' < github.com.crt && for cert in *.tmpcrt; do newname=$(openssl x509 -noout -subject -in $cert | sed -n 's/^.*CN=\(.*\)$/\1/; s/[ ,.*]/_/g; s/__/_/g; s/^_//g;p').pem; mv $cert $newname; done

# æˆ‘ä»¬å¾—åˆ°äº†ä¸¤ä¸ªè¯ä¹¦æ–‡ä»¶
# github_com.pem å’Œ DigiCert_SHA2_High_Assurance_Server_CA.pem

# é¦–å…ˆï¼ŒéªŒè¯ github_com.pem è¯ä¹¦ç¡®å®
# æ˜¯ç”± DigiCert_SHA2_High_Assurance_Server_CA.pem ç­¾å‘çš„

# æå– DigiCert_SHA2_High_Assurance_Server_CA çš„å…¬é’¥
# å‘½åä¸º issuer-pub.pem
$ openssl x509 -in DigiCert_SHA2_High_Assurance_Server_CA.pem -noout -pubkey > issuer-pub.pem

# æŸ¥çœ‹ github_com.pem çš„ç­¾å
# å¯ä»¥çœ‹åˆ° hash ç®—æ³•æ˜¯ sha256
$ openssl x509 -in github_com.pem -text -noout -certopt ca_default -certopt no_validity -certopt no_serial -certopt no_subject -certopt no_extensions -certopt no_signame
    Signature Algorithm: sha256WithRSAEncryption
         86:32:8f:9c:15:b8:af:e8:d1:de:08:3a:44:0e:71:20:24:d6:
         fc:0e:58:31:cc:aa:b4:ad:1c:d5:0c:c5:af:c4:bb:fe:5f:ac:
         90:6a:42:c8:21:eb:25:f1:6b:2c:37:b2:2a:a8:1a:6e:f2:d1:
         4f:a6:2f:bc:cf:3a:d8:c1:9f:30:c0:ec:93:eb:0a:5a:dc:cb:
         6c:32:1c:60:6e:ec:6e:f8:86:a5:4f:a0:b4:6d:6a:07:4a:21:
         58:d0:29:7d:65:8a:c8:da:6a:ba:ab:f0:75:21:33:00:40:6f:
         85:c5:13:e6:27:73:6c:ae:ea:e3:96:d0:53:db:c1:21:68:10:
         cf:e3:d8:50:b0:14:ec:a9:98:cf:b8:ce:61:5d:3d:a3:6d:93:
         34:c4:13:fa:11:66:a3:dd:be:10:19:70:49:e2:04:4d:81:2c:
         1f:2e:59:c6:2c:53:45:3b:ee:f6:13:f4:d0:2c:84:6e:28:6d:
         e4:e4:ca:e4:48:89:1b:ab:ec:22:1f:ee:12:d4:6c:75:e9:cc:
         0b:15:74:e9:6d:9f:db:40:1f:e2:24:85:a3:4b:a4:e9:cd:6b:
         c8:77:9f:87:4f:05:73:00:38:a5:23:54:68:fc:a2:3d:bf:18:
         19:0e:a8:fd:b9:5e:8c:5c:e8:fc:e4:a2:52:70:ee:79:a7:d2:
         27:4a:7a:49

# æå–ç­¾ååˆ°æ–‡ä»¶ä¸­
$ openssl x509 -in github_com.pem -text -noout -certopt ca_default -certopt no_validity -certopt no_serial -certopt no_subject -certopt no_extensions -certopt no_signame | grep -v 'Signature Algorithm' | tr -d '[:space:]:' | xxd -r -p > github_com-signature.bin

# ä½¿ç”¨ä¸Šçº§è¯ä¹¦çš„å…¬é’¥è§£å¯†ç­¾å
$ openssl rsautl -verify -inkey issuer-pub.pem -in github_com-signature.bin -pubin > github_com-signature-decrypted.bin

# æŸ¥çœ‹è§£å¯†åçš„ä¿¡æ¯
$ openssl asn1parse -inform DER -in github_com-signature-decrypted.bin
    0:d=0  hl=2 l=  49 cons: SEQUENCE
    2:d=1  hl=2 l=  13 cons: SEQUENCE
    4:d=2  hl=2 l=   9 prim: OBJECT            :sha256
   15:d=2  hl=2 l=   0 prim: NULL
   17:d=1  hl=2 l=  32 prim: OCTET STRING      [HEX DUMP]:A8AA3F746FE780B1E2E5451CE4383A9633C4399E89AA3637252F38F324DFFD5F

# å¯ä»¥å‘ç°ï¼Œhash å€¼æ˜¯ A8AA...FD5F

# æ¥ä¸‹æ¥è®¡ç®— github_com.pem çš„ hash å€¼

# æå–è¯ä¹¦çš„ body éƒ¨åˆ†
$ openssl asn1parse -in github_com.pem -strparse 4 -out github_com-body.bin &> /dev/null

# è®¡ç®— hash å€¼
$ openssl dgst -sha256 github_com-body.bin
SHA256(github_com-body.bin)= a8aa3f746fe780b1e2e5451ce4383a9633c4399e89aa3637252f38f324dffd5f
```

hash å€¼åŒ¹é…ï¼Œæˆ‘ä»¬æˆåŠŸæ ¡éªŒäº† github.pem è¿™ä¸ªè¯ä¹¦ç¡®å®æ˜¯ç”± DigiCert_SHA2_High_Assurance_Server_CA.pem è¿™ä¸ªè¯ä¹¦æ¥ç­¾å‘çš„ã€‚

ä¸Šé¢çš„æµç¨‹æ¯”è¾ƒç¹çï¼Œå…¶å®ä¹Ÿå¯ä»¥ç›´æ¥è®© openssl æ¥å¸®æˆ‘ä»¬éªŒè¯ã€‚

```
$ openssl dgst -sha256 -verify issuer-pub.pem -signature github_com-signature.bin  github_com-body.bin
Verified OK
```

æ¥ä¸‹æ¥çš„è¿‡ç¨‹æ˜¯ä¸Šé¢ä¸€æ ·ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬è·å–ä¸Šçº§è¯ä¹¦çš„ä¿¡æ¯ã€‚

```
# è·å–ä¸Šçº§è¯ä¹¦çš„åå­—
$ openssl x509 -in DigiCert_SHA2_High_Assurance_Server_CA.pem -text -noout | grep Issuer:
        Issuer: C=US, O=DigiCert Inc, OU=www.digicert.com, CN=DigiCert High Assurance EV Root CA
```

ç„¶åå°±æ˜¯æ ¡éªŒ DigiCert_SHA2_High_Assurance_Server_CA æ˜¯ç”± DigiCert High Assurance EV Root CA æ¥ç­¾å‘çš„ï¼ŒåŒæ—¶è¿™ä¸ªè¯ä¹¦å­˜åœ¨äºæˆ‘ä»¬ç³»ç»Ÿä¸­ã€‚

è¿™ä¸€æ­¥æˆ‘å°±ä¸å†é‡å¤äº†ï¼Œç•™ç»™å¤§å®¶ä½œä¸ºç»ƒä¹ ï½

## è‡ªç­¾å

æœ€åï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ€ä¹ˆè‡ªå·±ç­¾å‘è¯ä¹¦ç”¨äºæœ¬åœ°æµ‹è¯•ã€‚

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ openssl è¿™æ ·çš„åº•å±‚å·¥å…·æ¥å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼Œä½†æ˜¯ä¼šå¾ˆç¹çï¼šç”Ÿæˆæ ¹è¯ä¹¦ã€ç”Ÿæˆä¸‹çº§è¯ä¹¦ï¼Œä½¿ç”¨æ ¹è¯ä¹¦ç­¾å‘ä¸‹çº§è¯ä¹¦ã€å®‰è£…æ ¹è¯ä¹¦ã€‚

ç¨‹åºå‘˜é¦–å…ˆè¦è§£æ”¾çš„å°±æ˜¯è‡ªå·±çš„ç”Ÿäº§åŠ›ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå·¥å…· [mkcert](https://github.com/FiloSottile/mkcert)ã€‚

`brew intall mkcert` è¿›è¡Œå®‰è£…ï¼Œç„¶åä½¿ç”¨ `mkcert -install` å°†å®ƒçš„æ ¹è¯ä¹¦å®‰è£…åˆ°æˆ‘ä»¬çš„ç³»ç»Ÿä¸­ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥ä»»æ„ç”Ÿæˆæˆ‘ä»¬æƒ³è¦çš„è¯ä¹¦äº†ï¼Œä»¥ localhost ä¸ºä¾‹ï¼Œè¿è¡Œ `mkcert localhost`ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸¤ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­ `localhost-key.pem` æ˜¯ç§é’¥ï¼Œ`localhost.pem` æ˜¯è¯ä¹¦ï¼Œç”¨äºå‘é€ç»™å®¢æˆ·ç«¯ã€‚

ä½¿ç”¨ä¸€ä¸ª HTTP Server æ¥éªŒè¯ä¸€ä¸‹ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ [local-web-server](https://github.com/lwsjs/local-web-server)ã€‚

`yarn global add local-web-server` å®‰è£…å®Œæ¯•ä»¥åï¼Œä½¿ç”¨ `ws --key localhost-key.pem --cert localhost.pem` å¯åŠ¨æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼Œæ‰“å¼€ [https://localhost](https://localhost/):8000ï¼Œå¯ä»¥çœ‹åˆ°åœ°å€æ æœ‰äº†ä¸€æŠŠå¯çˆ±çš„å°é” ğŸ‰ã€‚
